name: Auto Generate SRS

# 1. è§¦å‘æ¡ä»¶è®¾ç½®ï¼ˆç²¾ç¡®åˆ° singbox ç›®å½•ï¼Œä¸å«å­ç›®å½•ï¼‰
on:
  push:
    branches:
      - main  # æ›¿æ¢æˆæ‚¨ä»“åº“çš„ä¸»åˆ†æ”¯åç§°
    paths:
      # ğŸš¨ è·¯å¾„ç²¾ç¡®ä¿®æ”¹ï¼šåªåŒ¹é… 'singbox/' ç›®å½•ä¸‹çš„ .json æ–‡ä»¶
      - 'singbox/*.json' 
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è¿è¡Œæ­¤å·¥ä½œæµ

jobs:
  generate-and-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # ä½¿ç”¨é»˜è®¤ token å³å¯ï¼Œé™¤éæœ‰ç‰¹æ®Šæƒé™éœ€æ±‚ï¼ˆä¾‹å¦‚åˆ†æ”¯ä¿æŠ¤ï¼‰
          token: ${{ secrets.GITHUB_TOKEN }} 

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # è¿è¡Œç”Ÿæˆè„šæœ¬
      - name: Run SRS generation script
        run: python generate_srs.py # è¿è¡Œæ‚¨ä½äºä»“åº“æ ¹ç›®å½•çš„è„šæœ¬

      # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶å˜åŠ¨ï¼ˆSRS æ–‡ä»¶ï¼‰
      - name: Check for file changes
        id: git_status
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "files_changed=true" >> $GITHUB_OUTPUT
          else
            echo "files_changed=false" >> $GITHUB_OUTPUT
          fi
        
      # æäº¤ç”Ÿæˆçš„ SRS æ–‡ä»¶
      - name: Commit generated SRS files
        if: steps.git_status.outputs.files_changed == 'true'
        uses: EndBug/add-and-commit@v9
        with:
          author_name: GitHub Actions Bot
          author_email: action@github.com
          message: 'chore(auto): Auto generate SRS files after JSON change'
          # ğŸš¨ è·¯å¾„ç²¾ç¡®ä¿®æ”¹ï¼šä»…æäº¤ singbox ç›®å½•ä¸‹çš„ .srs æ–‡ä»¶
          add: 'singbox/*.srs'
