name: Auto Generate SRS

# 1. 触发条件设置（精确到 singbox 目录，不含子目录）
on:
  push:
    branches:
      - main  # 替换成您仓库的主分支名称
    paths:
      # 🚨 路径精确修改：只匹配 'singbox/' 目录下的 .json 文件
      - 'singbox/*.json' 
  workflow_dispatch: # 允许手动运行此工作流

jobs:
  generate-and-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # 使用默认 token 即可，除非有特殊权限需求（例如分支保护）
          token: ${{ secrets.GITHUB_TOKEN }} 

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # 运行生成脚本
      - name: Run SRS generation script
        run: python generate_srs.py # 运行您位于仓库根目录的脚本

      # 检查是否有文件变动（SRS 文件）
      - name: Check for file changes
        id: git_status
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "files_changed=true" >> $GITHUB_OUTPUT
          else
            echo "files_changed=false" >> $GITHUB_OUTPUT
          fi
        
      # 提交生成的 SRS 文件
      - name: Commit generated SRS files
        if: steps.git_status.outputs.files_changed == 'true'
        uses: EndBug/add-and-commit@v9
        with:
          author_name: GitHub Actions Bot
          author_email: action@github.com
          message: 'chore(auto): Auto generate SRS files after JSON change'
          # 🚨 路径精确修改：仅提交 singbox 目录下的 .srs 文件
          add: 'singbox/*.srs'
